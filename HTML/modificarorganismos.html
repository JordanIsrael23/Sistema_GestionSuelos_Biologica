<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modificar Organismos</title>
    <link rel="icon" href="../ICONOS/LogoSistema.png" type="image/png">
    <link rel="stylesheet" href="../CSS/modificarorganismos.css">
</head>

<body>
    <header class="header">
        <a href="javascript:history.back()" class="back-icon">
            <img src="../ICONOS/icons8-left-2-50.png" alt="Regresar" class="icon">
        </a>
        <h1>Gesti√≥n Biol√≥gica de Suelos</h1>
    </header>

    <div class="container">
        <h1>Organismos</h1>
        <table>
            <thead>
                <tr>
                    <th>ID Detalle</th>
                    <th>ID Organismo</th>
                    <th>Nombre Organismo</th>
                    <th>ID Muestra</th>
                    <th>Modificar</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody id="tablaDetallesMuestras">
                <!-- Filas din√°micas aqu√≠ -->
            </tbody>
        </table>
    </div>
    <div class="container">
        <h1>Plantas</h1>
        <table>
            <thead>
                <tr>
                    <th>ID Detalle</th>
                    <th>ID Muestra</th>
                    <th>ID Planta</th>
                    <th>ID Tipo Planta</th>
                    <th>Nombre Planta</th>
                    <th>Modificar</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody id="tablaPlantas"> 
                <!-- Aqu√≠ se insertar√°n din√°micamente las filas -->
            </tbody>
        </table>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // 1Ô∏è‚É£ Hacer la petici√≥n para obtener los detalles de muestra
                const response = await fetch('/listadetalles');

                if (!response.ok) {
                    const error = await response.json();
                    console.error('‚ö†Ô∏è Error del servidor:', error);
                    alert('Error: ' + (error.error || 'No se pudieron cargar las muestras.'));
                    return;
                }

                const detalles = await response.json();

                if (detalles.length === 0) {
                    alert('‚ö†Ô∏è No hay detalles de muestras disponibles.');
                    return;
                }
            } catch (error) {
                console.error('‚ùå Error al cargar los detalles de muestra:', error);
                alert('Hubo un error al cargar los detalles.');
            }
        });


        function modificar(id) {
            window.location.href = `/modificarorganismos.html?id=${id}`;
        }

        async function eliminar(id) {
            console.log("üõ†Ô∏è Intentando eliminar el detalle con ID:", id); // üëà Agrega esta l√≠nea para verificar el ID

            const confirmacion = confirm("‚ö†Ô∏è ¬øSeguro que deseas eliminar este detalle de muestra?");
            if (!confirmacion) return;

            try {
                const response = await fetch(`/eliminardetalle/${encodeURIComponent(id)}`, { method: 'DELETE' });

                if (response.ok) {
                    alert('‚úÖ Detalle eliminado correctamente.');
                    location.reload();
                } else {
                    const errorData = await response.json();
                    alert(`‚ùå Error: ${errorData.error || 'No se pudo eliminar el detalle.'}`);
                }
            } catch (error) {
                console.error('‚ùå Error al eliminar el detalle:', error);
                alert('Hubo un error al eliminar el detalle.');
            }
        };

            ////////////plantas//////////////////////

            document.addEventListener('DOMContentLoaded', async () => {
    try {
        const response = await fetch('/listaplantas');
        if (!response.ok) {
            throw new Error('Error al obtener las plantas.');
        }

        const plantas = await response.json();
        const tabla = document.getElementById('tablaPlantas');

        if (plantas.length === 0) {
            console.warn('‚ö†Ô∏è No hay plantas registradas.');
            return;
        }

        plantas.forEach(planta => {
            const fila = document.createElement('tr');

            fila.innerHTML = `
                <td>${planta.id}</td>
                <td>${planta.tipo}</td>
                <td>${planta.nombre}</td>
                <td>
                    <button onclick="modificarPlanta(${planta.id})">Modificar</button>
                </td>
                <td>
                    <button onclick="eliminarPlanta(${planta.id})">Eliminar</button>
                </td>
            `;

            tabla.appendChild(fila);
        });
    } catch (error) {
        console.error('‚ùå Error:', error);
        alert('Hubo un problema al cargar las plantas.');
    }
});

// Funci√≥n para modificar planta
function modificarPlanta(id) {
    window.location.href = `/modificarplanta.html?id=${id}`;
}

// Funci√≥n para eliminar planta
async function eliminarPlanta(id) {
    const confirmacion = confirm("‚ö†Ô∏è ¬øSeguro que deseas eliminar esta planta?");
    if (!confirmacion) return;

    try {
        const response = await fetch(`/eliminarplanta/${encodeURIComponent(id)}`, { method: 'DELETE' });

        if (response.ok) {
            alert('‚úÖ Planta eliminada correctamente.');
            location.reload();
        } else {
            const errorData = await response.json();
            alert(`‚ùå Error: ${errorData.error || 'No se pudo eliminar la planta.'}`);
        }
    } catch (error) {
        console.error('‚ùå Error al eliminar la planta:', error);
        alert('Hubo un error al eliminar la planta.');
    }
}

    </script>


</body>

</html>